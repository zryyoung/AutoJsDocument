import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c as i,a,b as n,d as e,e as s,r as c}from"./app.6aa2b576.js";const r={},l=a("h1",{id:"work-manager",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#work-manager","aria-hidden":"true"},"#"),n(" work_manager")],-1),u=a("p",null,"This module is used to manage timed tasks and is used to automatically run scripts at certain times or when certain events are triggered. Just like the built-in timing task functions of Auto.js Pro, packaged scripts can also use these functions to create timing tasks.",-1),d={href:"/zh/powerManager",target:"_blank",rel:"noopener noreferrer"},k=s(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>$power_manager<span class="token punctuation">.</span><span class="token function">isIgnoringBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Ignore battery optimization is not turned on&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $power_manager<span class="token punctuation">.</span><span class="token function">requestIgnoreBatteryOptimizations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Due to the limitations of various systems, timing tasks cannot be guaranteed to run on time. Please try to add Auto.js Pro to various whitelists and allow self-starting permissions.</p></blockquote><h2 id="work-manager-adddailytask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-adddailytask-task" aria-hidden="true">#</a> $work_manager.addDailyTask(task)</h2><ul><li><code><span class="token property">task</span></code> {Object} is used to describe the configuration of this scheduled task, including: <ul><li><code><span class="token property">path</span></code> {string} The absolute path of the script to be run</li><li><code><span class="token property">time</span></code> {number} | {string} | {Date} The time when this scheduled task runs every day. It supports timestamp, string and Date objects</li><li><code><span class="token property">delay</span></code> {number} The delay before the task starts, in milliseconds, the default is 0; if the delay is long, this parameter is not reliable, it is recommended not to use this parameter to control a delay greater than 30s</li><li><code><span class="token property">loopTimes</span></code> {number} The number of task loops, the default is 1</li><li><code><span class="token property">interval</span></code> {number} Task cycle interval, in milliseconds, the default is 0; if the interval is long, this parameter is not reliable, it is recommended not to use this parameter to control the interval greater than 30s</li></ul></li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>Added a timed task that runs once a day. The time parameter will only retain the time of day, ignoring the year, month, and day.</p><p>For example, create a timed task that runs at 1:14 pm every day:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addDailyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-addweeklytask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-addweeklytask-task" aria-hidden="true">#</a> $work_manager.addWeeklyTask(task)</h2><ul><li><code><span class="token property">task</span></code> {Object} <ul><li><code><span class="token property">path</span></code> {string} The absolute path of the script to be run</li><li><code><span class="token property">time</span></code> {number} | {string} | {Date} The time when this scheduled task runs every day. It supports timestamp, string and Date objects</li><li><code><span class="token property">daysOfWeek</span></code> {Array&lt;string&gt;} runs on the days of the week, the parameters include: <code><span class="token punctuation">[</span><span class="token string">&#39;sunday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;monday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;tuesday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;wednesday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;thursday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;friday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;saturday&#39;</span><span class="token punctuation">]</span></code></li><li><code><span class="token property">delay</span></code> {number} The delay before the task starts, in milliseconds, the default is 0; if the delay is long, this parameter is not reliable, it is recommended not to use this parameter to control a delay greater than 30s</li><li><code><span class="token property">loopTimes</span></code> {number} The number of task loops, the default is 1</li><li><code><span class="token property">interval</span></code> {number} Task cycle interval, in milliseconds, the default is 0; if the interval is long, this parameter is not reliable, it is recommended not to use this parameter to control the interval greater than 30s</li></ul></li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>Add a timed task that runs on a weekly basis.</p><p>For example, create a timed task that runs 5 times every Monday and Tuesday at 1:14 pm</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// The timestamp is Mon Jun 21 2021 13:14:00 GMT+0800 (China Standard Time), in fact only the 13:14:00 parameter works</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;monday&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;tuesday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-adddisposabletask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-adddisposabletask-task" aria-hidden="true">#</a> $work_manager.addDisposableTask(task)</h2><ul><li><code><span class="token property">task</span></code> {Object} <ul><li><code><span class="token property">path</span></code> {string} The absolute path of the script to be run</li><li><code><span class="token property">time</span></code> {number} | {string} | {Date} The start time of this timing task, supports timestamp, string and Date object</li><li><code><span class="token property">delay</span></code> {number} The delay before the task starts, in milliseconds, the default is 0; if the delay is long, this parameter is not reliable, it is recommended not to use this parameter to control a delay greater than 30s</li><li><code><span class="token property">loopTimes</span></code> {number} The number of task cycles, the default is 1</li><li><code><span class="token property">interval</span></code> {number} Task cycle interval, in milliseconds, the default is 0; if the interval is long, this parameter is not reliable, it is recommended not to use this parameter to control the interval greater than 30s</li></ul></li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>This function will add a one-time timed task, and the task will be automatically deleted in the timed task after it is executed once.</p><p>For example, create a timed task that runs at 13:14 on May 21, 2021.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addDisposableTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-addintenttask-task" tabindex="-1"><a class="header-anchor" href="#work-manager-addintenttask-task" aria-hidden="true">#</a> $work_manager.addIntentTask(task)</h2><ul><li><code><span class="token property">task</span></code> {Object} <ul><li><code><span class="token property">path</span></code> {string} The absolute path of the script to be run</li><li><code><span class="token property">action</span></code> {string} Action name of the broadcast of the event that needs to be monitored</li><li><code><span class="token property">delay</span></code> {number} The delay before the task starts, in milliseconds, the default is 0; if the delay is long, this parameter is not reliable, it is recommended not to use this parameter to control a delay greater than 30s</li><li><code><span class="token property">loopTimes</span></code> {number} The number of task cycles, the default is 1</li><li><code><span class="token property">interval</span></code> {number} Task cycle interval, in milliseconds, the default is 0; if the interval is long, this parameter is not reliable, it is recommended not to use this parameter to control the interval greater than 30s</li></ul></li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>A new broadcast timer task is added, which will run when a specific event (broadcast) occurs.</p><p>The most critical parameter is the action of the broadcast event. The system will broadcast a specific Action when a specific event (such as a battery change) occurs, see <a href="#broadcast-action">Broadcast Action</a>.</p><p>For example, create a timed task that runs a script when the battery level changes:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-removetimedtask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-removetimedtask-id" aria-hidden="true">#</a> $work_manager.removeTimedTask(id)</h2><ul><li><code><span class="token property">id</span></code> {number} the id of the scheduled task</li><li>Return whether {boolean} is deleted successfully</li></ul><p>Use id to delete timed tasks that run by time.</p><h2 id="work-manager-removeintenttask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-removeintenttask-id" aria-hidden="true">#</a> $work_manager.removeIntentTask(id)</h2><ul><li><code><span class="token property">id</span></code> {number} the id of the scheduled task</li><li>Return whether {boolean} is deleted successfully</li></ul><p>Use id to delete timed tasks that run by events.</p><h2 id="work-manager-gettimedtask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-gettimedtask-id" aria-hidden="true">#</a> $work_manager.getTimedTask(id)</h2><ul><li><code><span class="token property">id</span></code> {number} the id of the scheduled task</li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>Obtain timed tasks running on time by id.</p><h2 id="work-manager-getintenttask-id" tabindex="-1"><a class="header-anchor" href="#work-manager-getintenttask-id" aria-hidden="true">#</a> $work_manager.getIntentTask(id)</h2><ul><li><code><span class="token property">id</span></code> {number} the id of the scheduled task</li><li>Return {<a href="#timedtask">TimedTask</a>}</li></ul><p>Obtain timed tasks that run by events by id.</p><p>E.g:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Add a timed task triggered by a change in the battery level of the phone</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Find the timing task by id</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">getIntentTask</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Print the path of the script run by the timing task</span>
<span class="token function">log</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>scriptPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-querytimedtasks-options" tabindex="-1"><a class="header-anchor" href="#work-manager-querytimedtasks-options" aria-hidden="true">#</a> $work_manager.queryTimedTasks([options])</h2><ul><li><code><span class="token property">options</span></code> {Object} Query parameters, optional. If it is not filled, all the timed tasks that run on time will be found <ul><li><code><span class="token property">path</span></code> {string} The path of the scheduled task script</li></ul></li><li>Return {Array&lt;[TimedTask](#timedtask)&gt;} the array of timed tasks found</li></ul><p>Search for time-running tasks through the script path, or query all time-running tasks.</p><p>E.g:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> jsPath <span class="token operator">=</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// Add a timed task that runs at 1:13 pm every Sunday, and run the script 5 times in a loop, with an interval of 5000 milliseconds</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addWeeklyTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> jsPath<span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1624252440000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">daysOfWeek</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sunday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">5000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Find timed tasks by script path</span>
<span class="token keyword">let</span> tasks <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">queryTimedTasks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> jsPath
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Delete all timed tasks found</span>
tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Delete: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">removeTimedTask</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="work-manager-queryintenttasks-options" tabindex="-1"><a class="header-anchor" href="#work-manager-queryintenttasks-options" aria-hidden="true">#</a> $work_manager.queryIntentTasks([options])</h2><ul><li><code><span class="token property">options</span></code> {Object} Query parameters, optional; if not filled, all timed tasks that run by events are queried <ul><li><code><span class="token property">path</span></code> {string} The path of the scheduled task script</li><li><code><span class="token property">action</span></code> {string} broadcast name</li></ul></li><li>Return {Array&lt;[TimedTask](#timedtask)&gt;} the array of timed tasks found</li></ul><p>Search for timed tasks that run by broadcast through script paths or monitor broadcasts, or query all timed tasks that run by broadcast.</p><p>E.g:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//Add a timed task triggered by a change in the battery level of the phone</span>
<span class="token keyword">let</span> task <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> Intent<span class="token punctuation">.</span><span class="token constant">ACTION_BATTERY_CHANGED</span><span class="token punctuation">,</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loopTimes</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Find all trigger event timing tasks</span>
<span class="token keyword">let</span> tasks <span class="token operator">=</span> $work_manager<span class="token punctuation">.</span><span class="token function">queryIntentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Print the trigger events of all the timed tasks found</span>
tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="timedtask" tabindex="-1"><a class="header-anchor" href="#timedtask" aria-hidden="true">#</a> TimedTask</h1><p>Represents a timed task object, which contains the basic information of this timed task.</p><h2 id="timedtask-id" tabindex="-1"><a class="header-anchor" href="#timedtask-id" aria-hidden="true">#</a> TimedTask.id</h2><ul><li>{number}</li></ul><p>The unique id of this timed task, used to find the timed task.</p><h2 id="timedtask-scriptpath" tabindex="-1"><a class="header-anchor" href="#timedtask-scriptpath" aria-hidden="true">#</a> TimedTask.scriptPath</h2><ul><li>{string}</li></ul><p>The path of the executed script of this timed task.</p><h2 id="timedtask-millis" tabindex="-1"><a class="header-anchor" href="#timedtask-millis" aria-hidden="true">#</a> TimedTask.millis</h2><ul><li>{number}</li></ul><p>The time stamp of the execution time of this timing task, in milliseconds.</p><h2 id="timedtask-delay" tabindex="-1"><a class="header-anchor" href="#timedtask-delay" aria-hidden="true">#</a> TimedTask.delay</h2><ul><li>{number}</li></ul><p>The delay set by this scheduled task,</p><h2 id="timedtask-interval" tabindex="-1"><a class="header-anchor" href="#timedtask-interval" aria-hidden="true">#</a> TimedTask.interval</h2><ul><li>{number}</li></ul><p>The interval of this timing task cycle.</p><h2 id="timedtask-looptimes" tabindex="-1"><a class="header-anchor" href="#timedtask-looptimes" aria-hidden="true">#</a> TimedTask.loopTimes</h2><ul><li>{number}</li></ul><p>The number of cycles of this timing task.</p><h2 id="timedtask-action" tabindex="-1"><a class="header-anchor" href="#timedtask-action" aria-hidden="true">#</a> TimedTask.action</h2><ul><li>{string}</li></ul><p>The trigger event of this timed task (this parameter is only available for broadcast timed tasks).</p><h1 id="broadcast-action" tabindex="-1"><a class="header-anchor" href="#broadcast-action" aria-hidden="true">#</a> Broadcast Action</h1>`,71),m={href:"https://developer.android.com/reference/android/content/Intent#constants_1",target:"_blank",rel:"noopener noreferrer"},h=a("code",null,[n("ConnectivityManager"),a("span",{class:"token punctuation"},"."),a("span",{class:"token constant"},"CONNECTIVITY_ACTION")],-1),v=s('<code>$engines<span class="token punctuation">.</span><span class="token function">myEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execArgv<span class="token punctuation">.</span>intent</code>',1),b=a("a",{href:"#broadcast-parameters"},"Broadcast Parameters",-1),g=s(`<p>Some common broadcast Actions are listed below:</p><p>| Broadcast name | Description | | :-------------------------------------: | :-------- ------------------------: | | org.autojs.autojs.action.startup | When Auto.js starts | | Intent.ACTION_BOOT_COMPLETED | At boot time | | Intent.ACTION_SCREEN_OFF | When the screen is off | | Intent.ACTION_SCREEN_ON | When the screen is on | | Intent.ACTION_USER_PRESENT | When the screen is unlocked | | Intent.ACTION_BATTERY_CHANGED | When the battery level changes | | Intent.ACTION_POWER_CONNECTED | When the power is connected | | Intent.ACTION_POWER_DISCONNECTED | When the power is disconnected | | ConnectivityManager.CONNECTIVITY_ACTION | When the network connection changes | | Intent.ACTION_PACKAGE_ADDED | When a new app is installed | | Intent.ACTION_PACKAGE_REMOVED | When the app is uninstalled | | Intent.ACTION_PACKAGE_REPLACED | When the app is updated | | Intent.ACTION_HEADSET_PLUG | When the headset is unplugged and plugged in | | Intent.ACTION_CONFIGURATION_CHANGED | When some settings (screen orientation, region, etc.) are changed | | Intent.ACTION_TIME_TICK | Once every minute |</p><p>Example:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Add a timed task triggered when Auto.js is started (software can also be used in the package)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;org.autojs.autojs.action.startup&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add a timing task triggered when the network status changes</span>
<span class="token keyword">let</span> ConnectivityManager <span class="token operator">=</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectivityManager<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$work_manager<span class="token punctuation">.</span><span class="token function">addIntentTask</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/sdcard/Scripts/conn_test.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">action</span><span class="token operator">:</span> ConnectivityManager<span class="token punctuation">.</span><span class="token constant">CONNECTIVITY_ACTION</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="broadcast-parameters" tabindex="-1"><a class="header-anchor" href="#broadcast-parameters" aria-hidden="true">#</a> Broadcast parameters</h1><p>When the timed task executed by the broadcast is executed, we can get the intent object through <code>$engines<span class="token punctuation">.</span><span class="token function">myEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execArgv<span class="token punctuation">.</span>intent</code>, and then check the parameters of the intent object through the Android documentation to obtain these parameters.</p>`,6),y={href:"https://developer.android.com/reference/android/os/BatteryManager#EXTRA_LEVEL",target:"_blank",rel:"noopener noreferrer"},f=a("code",null,[a("span",{class:"token constant"},"EXTRA_LEVEL")],-1),T=s(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Timed task script executed due to power changes</span>
<span class="token keyword">let</span> intent <span class="token operator">=</span> $engines<span class="token punctuation">.</span><span class="token function">myEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execArgv<span class="token punctuation">.</span>intent<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Please set up a scheduled task-run this script when the battery level changes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> BatteryManager <span class="token operator">=</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>BatteryManager<span class="token punctuation">;</span>
<span class="token keyword">let</span> level <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span>BatteryManager<span class="token punctuation">.</span><span class="token constant">EXTRA_LEVEL</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The power level is&quot;</span><span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="bug" tabindex="-1"><a class="header-anchor" href="#bug" aria-hidden="true">#</a> Bug</h1><p>As of version 8.7.1, Auto.js Pro may be executed twice when a timed task is triggered, and it will be fixed in subsequent versions of 8.7.</p>`,3);function w(_,A){const t=c("ExternalLinkIcon");return o(),i("div",null,[l,u,a("p",null,[n("When adding timed tasks, it is recommended to add code to apply for ignoring battery optimization to prevent Android from being restricted from running in the background. See "),a("a",d,[n("Battery Management-PowerManager"),e(t)]),n(".")]),k,a("p",null,[n("You can find most of the Intent Actions that come with the Android system in the Android document "),a("a",m,[n("Intent: Action"),e(t)]),n("; some system components will also automatically Define your own Action. For example, the Action triggered when the network connection changes is "),h,n(" (ConnectivityManager needs to be imported when using it). These Actions usually come with some additional parameters. You can get the broadcast parameters through "),v,n(", see "),b,n(".")]),g,a("p",null,[n("For example, in the broadcast of battery changes, query the document "),a("a",y,[n("BatteryManager"),e(t)]),n(" to know that the specific battery can be obtained through the "),f,n(" parameter.")]),T])}const E=p(r,[["render",w],["__file","timedTasks.html.vue"]]);export{E as default};
